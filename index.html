<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>💜 SHEcurity – Women's Safety</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="min-h-screen bg-gradient-to-br from-indigo-600 via-purple-600 to-pink-600 flex items-center justify-center p-4">
  <div id="root" class="w-full"></div>

  <!-- React + Babel -->
  <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

  <script type="text/babel">
    const { useState, useEffect, useRef } = React;

    function PanjapurBusSafetyApp(){
      const busTimings = {
        Viralimalai:["5:00 AM","5:50 AM","6:30 AM","7:35 AM","8:05 AM","8:10 AM","8:25 AM","8:50 AM","9:05 AM","9:20 AM","10:20 AM","11:00 AM","11:40 AM","3:45 PM","3:55 PM","4:10 PM","4:30 PM","4:45 PM","5:10 PM","5:50 PM","6:50 PM","6:55 PM","7:30 PM","8:00 PM","8:20 PM"],
        Mathur:["6:00 AM","6:30 AM","6:50 AM","7:58 AM","10:05 AM","1:50 PM","6:47 PM","9:15 PM","10:50 PM"],
        Erasanaickenpatti:["4:45 AM","5:30 AM","6:55 AM","7:55 AM","9:05 AM","9:55 AM","11:05 AM","12:00 PM","12:35 PM","2:10 PM","2:30 PM","4:20 PM","4:55 PM","6:10 PM","6:55 PM","8:55 PM","9:05 PM","10:25 PM"],
        Malampatti:["1:45 PM","4:30 PM","4:30 PM","7:30 PM","7:30 PM","7:30 PM","5:00 AM","5:45 AM","6:20 AM","7:30 AM","9:50 PM","10:15 PM","12:00 AM","1:45 PM","2:45 PM","4:30 PM","7:30 PM"],
        Keeranur:["2:40 PM","3:05 PM","3:22 PM","3:50 PM","4:50 PM","5:25 PM","5:40 PM","6:00 PM","7:25 PM","8:10 PM","8:15 PM","4:45 AM","5:30 AM","5:50 AM","6:37 AM","6:55 AM","7:05 AM","7:25 AM","8:10 AM","8:40 AM","8:55 AM","9:25 AM","10:05 AM","10:30 AM","10:55 AM","11:05 AM","11:25 AM","12:05 PM","12:25 PM","12:40 PM","1:00 PM","1:20 PM","1:50 PM","2:20 PM","2:40 PM","3:05 PM","3:22 PM","3:37 PM","4:07 PM","4:50 PM","5:25 PM","5:35 PM","6:05 PM","6:15 PM","7:05 PM","8:10 PM","8:20 PM","8:40 PM","8:50 PM","5:00 AM","1:00 PM"],
        "Anna university":["9:30 AM","2:20 PM","5:05 PM","7:40 PM"],
        "Fathima nagar":["5:45 AM","8:10 AM","8:55 AM","10:05 AM","11:45 AM","1:35 PM","5:50 PM","9:25 PM","10:05 PM"],
        Pakkudi:["3:00 PM"],
        Dheeranmanagar:["7:30 AM","9:05 AM","11:50 AM","1:50 PM","3:15 PM","5:20 PM","7:20 PM","9:30 PM"],
        BHEL:["1:30 PM","4:55 PM"],
        Thuraikudi:["7:40 AM","8:40 AM","10:30 AM","1:55 PM","3:55 PM","6:45 PM","8:20 PM","10:00 PM"]
      };

      const [selectedStop,setSelectedStop]=useState(Object.keys(busTimings)[0]);
      const [contacts,setContacts]=useState(()=>JSON.parse(localStorage.getItem("ps_contacts"))||[]);
      const [newName,setNewName]=useState("");
      const [newNumber,setNewNumber]=useState("");

      const audioCtxRef=useRef(null);
      const sirenOscRef=useRef(null);
      const sirenPlayingRef=useRef(false);

      function startSiren(){
        if(sirenPlayingRef.current) return;
        const AudioContext=window.AudioContext||window.webkitAudioContext;
        const ctx=new AudioContext();
        audioCtxRef.current=ctx;
        const osc=ctx.createOscillator();
        const gain=ctx.createGain();
        osc.type="sine";osc.frequency.value=500;gain.gain.value=0.4;
        osc.connect(gain).connect(ctx.destination);
        osc.start();
        let up=true;
        const interval=setInterval(()=>{
          if(!sirenPlayingRef.current){clearInterval(interval);return;}
          osc.frequency.setTargetAtTime(up?900:400,ctx.currentTime,0.2);
          up=!up;
        },500);
        sirenOscRef.current={osc,interval};
        sirenPlayingRef.current=true;
      }
      function stopSiren(){
        if(!sirenPlayingRef.current) return;
        const {osc,interval}=sirenOscRef.current||{};
        if(interval) clearInterval(interval);
        if(osc){try{osc.stop();osc.disconnect();}catch(e){}}
        if(audioCtxRef.current){try{audioCtxRef.current.close();}catch(e){}}
        sirenOscRef.current=null;
        sirenPlayingRef.current=false;
      }
      function toggleSiren(){
        sirenPlayingRef.current?stopSiren():startSiren();
      }

      function addContact(){
        if(!newNumber.match(/^\+?\d{6,15}$/)){alert("Invalid number");return;}
        const c={id:Date.now(),name:newName||newNumber,number:newNumber};
        setContacts(p=>[c,...p]);
        setNewName("");setNewNumber("");
      }
      function removeContact(id){
        setContacts(p=>p.filter(c=>c.id!==id));
      }
      useEffect(()=>{localStorage.setItem("ps_contacts",JSON.stringify(contacts));},[contacts]);

function getLocation(callback) {
  if (!navigator.geolocation) {
    alert("❌ Geolocation not supported in this browser");
    return;
  }

  navigator.geolocation.getCurrentPosition(
    (pos) => {
      callback(null, pos.coords);
    },
    (err) => {
      let msg = "⚠️ Location failed: ";
      switch(err.code) {
        case err.PERMISSION_DENIED:
          msg += "Permission denied. Please allow location access.";
          break;
        case err.POSITION_UNAVAILABLE:
          msg += "Location unavailable (check GPS or network).";
          break;
        case err.TIMEOUT:
          msg += "Timed out while getting location.";
          break;
        default:
          msg += "Unknown error.";
      }
      alert(msg);
    },
    { enableHighAccuracy: true, timeout: 10000, maximumAge: 0 }
  );
}

async function sendEmergencyAlert() {
  getLocation(async (err, coords) => {
    if (err) return; // already handled
    const { latitude, longitude } = coords;
    const mapsLink = `https://www.google.com/maps?q=${latitude},${longitude}`;
    const message = `🚨 EMERGENCY! I need help. My location: ${mapsLink}`;
    try { await navigator.clipboard.writeText(message); } catch(e){}
    window.open(`sms:1234567890?body=${encodeURIComponent(message)}`);
    window.open(`https://wa.me/1234567890?text=${encodeURIComponent(message)}`, "_blank");
  });
}

async function sendSafeCheckIn() {
  getLocation(async (err, coords) => {
    if (err) return; // already handled
    const { latitude, longitude } = coords;
    const mapsLink = `https://www.google.com/maps?q=${latitude},${longitude}`;
    const message = `✅ I reached safely! My location: ${mapsLink}`;
    try { await navigator.clipboard.writeText(message); } catch(e){}
    window.open(`sms:1234567890?body=${encodeURIComponent(message)}`);
    window.open(`https://wa.me/1234567890?text=${encodeURIComponent(message)}`, "_blank");
  });
}


         return (
        <div className="backdrop-blur-xl bg-white/20 rounded-3xl shadow-2xl p-8 max-w-6xl w-full text-white">
          {/* Header */}
          <header className="flex flex-col md:flex-row md:items-center md:justify-between gap-4 mb-8">
          
          <h1 className="text-3xl font-extrabold tracking-tight">💜 SHEcurity – Bus Safety</h1>
          <p className="text-sm text-white/80 mt-1">Women’s Safety First ✨</p>
        
              <div className="flex gap-3">
              <button onClick={toggleSiren} className="px-5 py-2.5 rounded-xl bg-red-600 hover:bg-red-700 font-medium transition">🔊 Siren</button>
              <button onClick={sendEmergencyAlert} className="px-5 py-2.5 rounded-xl bg-yellow-400 text-black hover:bg-yellow-300 font-medium transition">⚠️ Alert</button>
              <button onClick={sendSafeCheckIn} className="px-5 py-2.5 rounded-xl bg-green-400 text-black hover:bg-green-300 font-medium transition">✅ Reached</button>
            </div>
          </header>

          {/* Main Grid */}
          <div className="grid grid-cols-1 md:grid-cols-2 gap-8">
            {/* Left: Stops & Contacts */}
            <div className="space-y-6">
              <section>
                <h2 className="font-semibold text-xl mb-3">🚏 Stops</h2>
                <select value={selectedStop} onChange={e=>setSelectedStop(e.target.value)} className="w-full p-3 border rounded-lg text-black">
                  {Object.keys(busTimings).map(s=><option key={s}>{s}</option>)}
                </select>
                <div className="bg-white/30 rounded-xl p-4 mt-4">
                  <h3 className="font-medium mb-2">⏰ Timings for {selectedStop}</h3>
                  <ul className="space-y-1 max-h-56 overflow-y-auto pr-2">
                    {busTimings[selectedStop].map((t,i)=><li key={i} className="px-2 py-1">{t}</li>)}
                  </ul>
                </div>
              </section>

              <section>
                <h3 className="font-semibold text-xl mb-3">📞 Emergency Contacts</h3>
                <div className="flex gap-2">
                  <input value={newName} onChange={e=>setNewName(e.target.value)} placeholder="Name" className="p-3 border rounded-lg flex-1 text-black" />
                  <input value={newNumber} onChange={e=>setNewNumber(e.target.value)} placeholder="Number" className="p-3 border rounded-lg w-44 text-black" />
                  <button onClick={addContact} className="px-4 py-2 bg-blue-600 hover:bg-blue-700 rounded-lg font-medium">Add</button>
                </div>
                <ul className="mt-4 space-y-3">
                  {contacts.map(c=>(
                    <li key={c.id} className="flex items-center justify-between bg-white/30 rounded-xl p-3">
                      <div>
                        <div className="font-medium">{c.name}</div>
                        <div className="text-sm">{c.number}</div>
                      </div>
                      <button onClick={()=>removeContact(c.id)} className="px-3 py-1 bg-red-500 hover:bg-red-600 rounded-lg">Remove</button>
                    </li>
                  ))}
                </ul>
              </section>
            </div>

            {/* Right: Safe Routes + Safety Locations */}
            <div className="space-y-6">
              <section>
                <h2 className="font-semibold text-xl mb-3">🛡️ Safe Routes</h2>
                <p className="text-sm mb-4">Coming soon: Route safety ratings & notes from commuters.</p>
                <div className="space-y-3">
                  <div className="bg-white/30 p-4 rounded-xl">
                    <p className="text-sm">✅ Main Road – Well-lit, safe</p>
                  </div>
                  <div className="bg-white/30 p-4 rounded-xl">
                    <p className="text-sm">⚠️ Shortcut Street – Avoid at night</p>
                  </div>
                </div>
              </section>

              <section>
                <h2 className="font-semibold text-xl mb-3">🚨 Safety Locations in Trichy</h2>
                <div className="bg-white/30 p-4 rounded-xl max-h-64 overflow-y-auto text-sm space-y-2">
                  <h3 className="font-medium">🚔 Police Stations</h3>
                  <ul className="list-disc list-inside">
                    <li>Cantonment Police Station</li>
                    <li>Sangiliyandapuram Police Station</li>
                    <li>Thillai Nagar Police Station</li>
                    <li>Srirangam Police Station</li>
                    <li>Fort Police Station</li>
                  </ul>

                  <h3 className="font-medium mt-3">🏠 Safe Shelters & Hostels</h3>
                  <ul className="list-disc list-inside">
                    <li>Govt. Working Women’s Hostel</li>
                    <li>YWCA Women’s Hostel</li>
                    <li>Nehru Memorial Hostel</li>
                    <li>St. Joseph’s Women’s Hostel</li>
                    <li>Anbalaya / Good Shepherd Homes</li>
                  </ul>

                  <h3 className="font-medium mt-3">🏥 Emergency Clinics</h3>
                  <ul className="list-disc list-inside">
                    <li>Kauvery Hospital</li>
                    <li>Apollo Speciality Hospital</li>
                    <li>Cauvery Women’s Care Hospital</li>
                    <li>MGM Healthcare Srirangam</li>
                    <li>Govt. HQ Hospital</li>
                  </ul>
                </div>
              </section>
            </div>
          </div>

          {/* Footer */}
          <footer className="mt-8 pt-4 border-t border-white/20 text-sm text-white/80 text-center">
            ⚡ Note: SMS/WhatsApp sending depends on device support. This demo copies text & opens apps.
          </footer>
        </div>
      );
    }

    ReactDOM.createRoot(document.getElementById('root')).render(<PanjapurBusSafetyApp/>);
  </script>
</body>
</html>
